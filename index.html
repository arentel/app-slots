<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gaudí Slots</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <style>
    /* Video de fondo */
    #background-video {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: -2; /* Detrás de todo el contenido */
    }

    /* Filtro oscuro */
    #dark-filter {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5); /* Ajusta la opacidad para el efecto deseado */
      z-index: -1; /* Justo encima del video pero detrás del contenido */
    }

    /* Fondo general y estilo */
    body {
      color: #fff;
      font-family: 'Montserrat', sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }

    /* Header fijo */
    header {
      background-color: #222;
      color: #f0a500;
      padding: 10px;
      font-size: 1.5em;
      font-weight: bold;
      position: fixed;
      top: 0;
      width: 100%;
      box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.5);
      z-index: 100;
    }

    h2 {
      font-size: 2em;
      margin: 1em 0 0.5em;
      color: #f0a500;
      text-shadow: 0px 0px 5px rgba(255, 215, 0, 0.7);
    }

    #game-container {
      margin-top: 80px; /* Espacio para el header */
    }

    #game {
      margin: 10px auto;
      width: 90vw;
      max-width: 600px;
      height: 60vh;
      max-height: 400px;
      position: relative;
      border-radius: 15px;
      box-shadow: 0px 0px 15px rgba(255, 215, 0, 0.7);
      background-color: #222;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      transition: box-shadow 0.3s;
      animation: pulsate 5s ease-in-out infinite;
    }

    @keyframes pulsate {
      0% { box-shadow: 0px 0px 15px 3px rgba(255, 215, 0, 0.5); }
      50% { box-shadow: 0px 0px 25px 10px rgba(255, 215, 0, 0.7); }
      100% { box-shadow: 0px 0px 15px 3px rgba(255, 215, 0, 0.5); }
    }

    #countdown {
      font-size: 1.2em;
      margin-top: 10px;
      font-weight: bold;
      color: #f0a500;
      text-shadow: 0px 0px 5px rgba(255, 215, 0, 0.8);
    }

    #spin_button {
      width: 50vw;
      max-width: 180px;
      height: 8vh;
      max-height: 50px;
      background-color: #f0a500;
      color: #222;
      font-size: 1.2em;
      font-weight: bold;
      border-radius: 10px;
      margin-top: 20px;
      cursor: pointer;
      box-shadow: 0px 5px 10px rgba(0, 0, 0, 0.5);
      transition: all 0.2s ease;
    }

    #spin_button:hover {
      transform: scale(1.1);
      box-shadow: 0px 8px 15px rgba(255, 165, 0, 0.8);
    }

    #spin_button:active {
      transform: scale(0.95);
    }

    .popup {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      color: #fff;
      font-size: 1.2em;
      justify-content: center;
      align-items: center;
      text-align: center;
      z-index: 10;
    }

    .popup-content {
      background: #222;
      padding: 20px;
      border: 2px solid #f0a500;
      border-radius: 10px;
      box-shadow: 0px 0px 10px rgba(255, 215, 0, 0.5);
      max-width: 90vw;
      animation: fadeIn 0.5s;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* Ajuste en móviles */
    @media (max-width: 768px) {
      #background-video {
        height: auto;
        min-height: 100%;
      }
      #dark-filter {
        background-color: rgba(0, 0, 0, 0.6); /* Oscurecer un poco más en móviles */
      }
    }
  </style>
</head>
<body>
  <!-- Video de fondo -->
  <video id="background-video" autoplay muted loop>
    <source src="images/casino-royale.MP4" type="video/mp4">
    Tu navegador no soporta el video en bucle.
  </video>

  <!-- Filtro oscuro -->
  <div id="dark-filter"></div>

  <header>GAUDÍ SLOTS</header>
  <div id="game-container">
    <h2>¡Prueba tu suerte!</h2>
    <div id="game"></div>
    <p id="countdown">Próximo giro automático en: 20:00</p>
    <button id="spin_button">GIRAR</button>
  </div>

  <div class="popup" id="popup">
    <div class="popup-content" id="popup-content">
      <!-- Contenido del anuncio de premio se llenará dinámicamente -->
    </div>
  </div>

  <script>
    emailjs.init("js5XmG0FCVqaqyfy_");

    const config = {
      type: Phaser.AUTO,
      width: '100%',
      height: '100%',
      scale: {
        mode: Phaser.Scale.FIT,
        autoCenter: Phaser.Scale.CENTER_BOTH
      },
      parent: 'game',
      backgroundColor: '#111',
      scene: { preload, create, update }
    };

    const game = new Phaser.Game(config);

    let slots = [];
    let symbols = ['ron_barcelo', 'puerto_indias', 'absolut_vodka'];
    let spinning = false;
    let countdownTime = 1200;
    let countdownText = document.getElementById('countdown');
    const popup = document.getElementById('popup');
    const popupContent = document.getElementById('popup-content');
    const slotHeight = 200;

    function preload() {
      this.load.image('ron_barcelo', 'images/ron.png');
      this.load.image('puerto_indias', 'images/puerto.png');
      this.load.image('absolut_vodka', 'images/absolut.png');
    }

    function create() {
      const slotXStart = this.scale.width / 5;
      const slotSpacing = this.scale.width / 3.5;

      for (let i = 0; i < 3; i++) {
        const randomSymbol = Phaser.Math.RND.pick(symbols);
        const slot = this.add.image(slotXStart + i * slotSpacing, this.scale.height / 2, randomSymbol);
        slot.displayHeight = slotHeight;
        slot.scaleX = slot.scaleY;
        slots.push(slot);
      }

      document.getElementById('spin_button').onclick = () => {
        spinSlots.call(this);
      };

      this.time.addEvent({
        delay: 1000,
        callback: updateCountdown,
        callbackScope: this,
        loop: true
      });
    }

    function spinSlots() {
      if (spinning) return;
      spinning = true;
      countdownTime = 1200;
      document.getElementById('game').classList.remove('win'); // Quitar resplandor

      slots.forEach((slot, index) => {
        this.tweens.add({
          targets: slot,
          y: slot.y + 400,
          duration: 200,
          repeat: 15,
          delay: index * 150,
          onRepeat: () => {
            const randomSymbol = Phaser.Math.RND.pick(symbols);
            slot.setTexture(randomSymbol);
            slot.displayHeight = slotHeight;
            slot.scaleX = slot.scaleY;
          },
          onComplete: () => {
            const finalSymbol = Phaser.Math.RND.pick(symbols);
            slot.setTexture(finalSymbol);
            slot.displayHeight = slotHeight;
            slot.scaleX = slot.scaleY;
            slot.y -= 400;
            if (index === slots.length - 1) {
              setTimeout(checkResult, 200);
              spinning = false;
            }
          }
        });
      });
    }

    function checkResult() {
      const result = slots.map(slot => slot.texture.key);
      if (result[0] === result[1] && result[1] === result[2]) {
        document.getElementById('game').classList.add('win');
        const specialPrice = Phaser.Math.RND.pick([3, 4, 5]);
        const prizeMessage = `${result[0].replace('_', ' ')} a un precio especial de ${specialPrice}€`;
        showPopup(`¡Ganaste! ${prizeMessage}`, 5000, prizeMessage);
      } else {
        showPopup("No has ganado esta vez. ¡Sigue intentando!", 5000);
      }
    }

    function updateCountdown() {
      if (countdownTime > 0) {
        countdownTime--;
        const minutes = Math.floor(countdownTime / 60);
        const seconds = countdownTime % 60;
        countdownText.innerText = `Próximo giro automático en: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      } else {
        spinSlots.call(this);
      }
    }

    function sendEmail(prize, email) {
      emailjs.send("service_jlaxhkd", "template_lx9zm3r", {
        prize: prize,
        to_email: email,
      })
      .then(response => console.log("Correo enviado con éxito!", response.status, response.text))
      .catch(error => console.log("Error al enviar el correo:", error));
    }

    function showPopup(message, duration, prize) {
      popupContent.innerText = message;
      popup.style.display = 'flex';

      if (prize) {
        const email = prompt('¡Has ganado! Ingresa tu correo para recibir el premio:');
        if (email) {
          sendEmail(prize, email);
        }
      }

      setTimeout(() => {
        popup.style.display = 'none';
      }, duration);
    }

    function update() {}
  </script>
</body>
</html>
